# Codebase Structure

**Analysis Date:** 2026-01-18

## Directory Layout

```
makerblocks/
├── makerblocks.php          # Plugin entry (constants, module loader)
├── package.json             # npm scripts, dependencies
├── tsconfig.json            # TypeScript configuration
├── vitest.config.ts         # Test runner config
├── components.json          # Shadcn CLI config
├── .editorconfig            # Editor formatting rules
├── src/                     # Source code (pre-build)
│   ├── blocks-dev/          # Block development directories
│   ├── components/          # Shared React components
│   │   └── ui/              # Shadcn base components
│   ├── lib/                 # Shared utilities
│   ├── scripts/             # Frontend scripts (hydration)
│   ├── styles/              # Sass 7-1 architecture
│   ├── test/                # Test setup
│   ├── types/               # TypeScript definitions
│   └── utils/               # Legacy utilities
├── blocks/                  # Compiled blocks (generated)
├── assets/                  # Compiled assets (generated)
│   ├── js/                  # Bundled scripts
│   ├── css/                 # Compiled styles
│   ├── admin/               # Admin-specific assets
│   └── fonts/               # Bootstrap Icons font
├── inc/                     # PHP modules
├── tests/                   # Block validation tests
└── vendor/                  # PHP dependencies (Carbon Fields)
```

## Directory Purposes

**src/blocks-dev/**
- Purpose: Block development source files
- Contains: Block directories, each with 5-file pattern
- Key files: `header/Header.tsx`, `app/edit.tsx`
- Subdirectories: Complex blocks have `components/`, `hooks/`, `utils/`

**src/components/ui/**
- Purpose: Shadcn base components (shared across all blocks)
- Contains: `button.tsx`, `sheet.tsx`, `dialog.tsx`, `dropdown-menu.tsx`, `accordion.tsx`, `card.tsx`, `input.tsx`, `label.tsx`, `badge.tsx`, `tabs.tsx`
- Key files: All components are self-contained with variants

**src/lib/**
- Purpose: Shared utilities for all blocks
- Contains: `utils.ts` (cn function), `api.ts` (fetch helpers)
- Key files: `utils.ts` - Class name merging with clsx + tailwind-merge

**src/scripts/**
- Purpose: Frontend JavaScript (hydration, events)
- Contains: `MakerBlocks.tsx` (component registry), `index.ts` (entry)
- Key files: `MakerBlocks.tsx` - Registered components for frontend hydration

**src/styles/**
- Purpose: Sass 7-1 architecture
- Contains: SCSS partials organized by type
- Subdirectories: `abstracts/`, `base/`, `layout/`, `components/`, `pages/`, `vendors/`
- Key files: `styles.scss` (main entry), `vendors/tailwind/_source.scss` (Tailwind + CSS vars)

**src/test/**
- Purpose: Test setup and utilities
- Contains: `setup.ts` (Vitest setup with testing-library)
- Key files: `setup.ts` imports `@testing-library/jest-dom`

**src/types/**
- Purpose: TypeScript type definitions
- Contains: `global.d.ts`, `wordpress.d.ts`, `api.d.ts`
- Key files: `global.d.ts` - Window extensions for siteData

**src/utils/**
- Purpose: Legacy shared utility functions
- Contains: `contactUtils.js`, `formatters.js`, `urlFilters.js`
- Key files: Formatting, validation, URL building helpers

**blocks/**
- Purpose: Compiled blocks (generated by wp-scripts)
- Contains: Compiled block directories
- Key files: `{block}/index.js`, `{block}/index.asset.php`, `{block}/render.php`
- Source: Built from `src/blocks-dev/`

**inc/**
- Purpose: PHP modules loaded by plugin
- Contains: WordPress hooks, registration, helpers
- Key files: `blocks.php`, `enqueue_assets.php`, `wp_localize.php`, `helpers.php`

## Key File Locations

**Entry Points:**
- `makerblocks.php` - Plugin initialization
- `src/scripts/MakerBlocks.tsx` - Frontend hydration class
- `inc/blocks.php` - Block registration

**Configuration:**
- `package.json` - npm scripts and dependencies
- `tsconfig.json` - TypeScript compiler options
- `vitest.config.ts` - Test runner configuration
- `components.json` - Shadcn component configuration

**Core Logic:**
- `inc/blocks.php` - Block registration, categories, allowed types
- `inc/enqueue_assets.php` - Asset management
- `inc/wp_localize.php` - JS data injection (`window.siteData`)
- `src/lib/utils.ts` - `cn()` class merging utility

**Testing:**
- `src/test/setup.ts` - Vitest setup file
- `tests/validate-block-structure.js` - Block structure validation

## Naming Conventions

**Files:**
- `PascalCase.tsx` for React components (`Header.tsx`, `Services.tsx`)
- `kebab-case.tsx` for Shadcn UI components (`dropdown-menu.tsx`)
- `kebab-case` for block directories (`contact-form/`, `hero-section/`)
- `snake_case.php` for PHP files (`enqueue_assets.php`)

**Directories:**
- `kebab-case` for all directories
- Plural for collections (`blocks/`, `components/`, `scripts/`)

**Special Patterns:**
- `_template/` - Block scaffold (excluded from validation)
- `*.asset.php` - wp-scripts generated dependency files
- `index.ts` - Barrel exports and entry points

## Where to Add New Code

**New Block:**
- Primary code: `src/blocks-dev/{block-name}/`
- Files: `block.json`, `index.ts`, `edit.tsx`, `{BlockName}.tsx`, `render.php`
- Registration: Add to `inc/blocks.php:makerblocks_get_custom_blocks()`
- Hydration: Register in `src/scripts/MakerBlocks.tsx` component registry

**New Shadcn Component:**
- Implementation: `src/components/ui/{component-name}.tsx`
- Run: `npx shadcn@latest add {component}` (auto-places in ui/)

**New Shared Component:**
- Implementation: `src/components/{ComponentName}.tsx`
- Export: Add to `src/components/index.ts`

**New Utility:**
- Implementation: `src/lib/{utilName}.ts`
- Types: Add to `src/types/` if needed

**New PHP Module:**
- Implementation: `inc/{module_name}.php`
- Loading: Add to `$includes` array in `makerblocks.php`

## Special Directories

**blocks/**
- Purpose: Compiled block output
- Source: Generated by `npm run wp-build-blocks`
- Committed: Yes (needed for WordPress)

**assets/js/, assets/css/**
- Purpose: Compiled frontend assets
- Source: Generated by build scripts
- Committed: Yes (needed for production)

**vendor/**
- Purpose: PHP dependencies (Carbon Fields)
- Source: Composer (manually committed)
- Committed: Yes

**node_modules/**
- Purpose: npm dependencies
- Source: `npm install`
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-01-18*
*Update when directory structure changes*
